<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Sign Up - NXTRIX CRM ‚Ä¢ Choose Your Plan</title>
  <meta name="description" content="Join NXTRIX CRM today. Choose from Solo, Team, or Business plans with founders pricing. Start your real estate investment journey.">
  
  <!-- Supabase -->
  <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
  
  <!-- EmailJS -->
  <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@emailjs/browser@4/dist/email.min.js"></script>
  
  <style>
    :root{
      --bg:#0b0d12; --surface:#1a1b23; --border:rgba(255,255,255,.08); --text:#e5e7eb; --muted:#9ca3af; --brand:#7c5cff; --brand-2:#24d1ff; --accent:#10b981; --warning:#f59e0b; --error:#ef4444;
    }
    *{box-sizing:border-box; margin:0; padding:0}
    body{font-family:'Inter',-apple-system,BlinkMacSystemFont,sans-serif; background:var(--bg); color:var(--text); line-height:1.6; overflow-x:hidden}
    .container{max-width:1200px; margin:0 auto; padding:0 20px}
    h1,h2,h3,h4{font-weight:700; line-height:1.2; margin-bottom:12px}
    h1{font-size:2.5rem; background:linear-gradient(135deg,var(--brand),var(--brand-2)); -webkit-background-clip:text; -webkit-text-fill-color:transparent}
    h2{font-size:2rem; color:var(--text)}
    h3{font-size:1.5rem; color:var(--text)}
    p{margin-bottom:16px; color:var(--muted)}
    
    /* Header */
    header{padding:20px 0; border-bottom:1px solid var(--border)}
    nav{display:flex; justify-content:space-between; align-items:center}
    .logo{font-size:1.5rem; font-weight:800; background:linear-gradient(135deg,var(--brand),var(--brand-2)); -webkit-background-clip:text; -webkit-text-fill-color:transparent}
    .back-link{color:var(--muted); text-decoration:none; font-weight:500; transition:color 0.2s}
    .back-link:hover{color:var(--text)}
    
    /* Main Content */
    main{padding:60px 0}
    .signup-header{text-align:center; margin-bottom:60px}
    .signup-header h1{font-size:3rem; margin-bottom:16px}
    .signup-header p{font-size:1.2rem; max-width:600px; margin:0 auto}
    
    /* Plan Cards */
    .plans{display:grid; grid-template-columns:repeat(auto-fit,minmax(350px,1fr)); gap:32px; margin-bottom:60px}
    .plan{background:var(--surface); border:2px solid var(--border); border-radius:16px; padding:32px; position:relative; transition:all 0.3s}
    .plan:hover{border-color:var(--brand); transform:translateY(-4px)}
    .plan.featured{border-color:var(--brand); background:linear-gradient(135deg,rgba(124,92,255,0.1),rgba(36,209,255,0.1))}
    .plan.featured::before{content:'MOST POPULAR'; position:absolute; top:-12px; left:50%; transform:translateX(-50%); background:var(--brand); color:white; padding:6px 16px; border-radius:20px; font-size:0.8rem; font-weight:700}
    
    .plan h3{color:var(--text); margin-bottom:8px}
    .plan .price{font-size:2.5rem; font-weight:800; color:var(--text); margin-bottom:4px}
    .plan .price-note{font-size:0.9rem; color:var(--muted); margin-bottom:24px}
    .plan .description{color:var(--muted); margin-bottom:32px; min-height:48px}
    
    .features{list-style:none; margin-bottom:32px}
    .features li{padding:8px 0; color:var(--muted); position:relative; padding-left:24px}
    .features li::before{content:'‚úì'; position:absolute; left:0; color:var(--accent); font-weight:700}
    .features li.disabled{color:#555}
    .features li.disabled::before{content:'‚úó'; color:#666}
    
    /* Toggle */
    .toggle{display:inline-flex; background:var(--surface); border:1px solid var(--border); border-radius:999px; padding:6px; gap:6px; margin:24px auto}
    .toggle button{background:transparent; border:0; color:var(--muted); padding:8px 16px; border-radius:999px; cursor:pointer; transition:all 0.2s ease; font-size:0.9rem}
    .toggle button.active{background:var(--brand); color:white}
    
    /* Buttons */
    .btn{padding:16px 32px; border:none; border-radius:8px; font-weight:600; cursor:pointer; transition:all 0.2s; text-decoration:none; display:inline-block; text-align:center; width:100%}
    .btn.primary{background:linear-gradient(135deg,var(--brand),var(--brand-2)); color:white}
    .btn.primary:hover{transform:translateY(-2px); box-shadow:0 8px 25px rgba(124,92,255,0.4)}
    .btn.secondary{background:var(--surface); color:var(--text); border:2px solid var(--border)}
    .btn.secondary:hover{border-color:var(--brand); background:rgba(124,92,255,0.1)}
    
    /* Form */
    .signup-form{background:var(--surface); border:1px solid var(--border); border-radius:16px; padding:40px; margin:40px auto; max-width:500px}
    .form-group{margin-bottom:24px}
    .form-group label{display:block; margin-bottom:8px; font-weight:600; color:var(--text)}
    .form-group input,.form-group select{width:100%; padding:12px 16px; border:1px solid var(--border); border-radius:8px; background:var(--bg); color:var(--text); font-size:16px}
    .form-group input:focus,.form-group select:focus{outline:none; border-color:var(--brand); box-shadow:0 0 0 3px rgba(124,92,255,0.1)}
    
    /* Trust Indicators */
    .trust{text-align:center; margin:60px 0}
    .trust-items{display:flex; justify-content:center; gap:40px; flex-wrap:wrap; margin-top:32px}
    .trust-item{color:var(--muted); font-size:0.9rem}
    .trust-item::before{content:'üîí'; margin-right:8px}
    
    @media (max-width: 768px) {
      .plans{grid-template-columns:1fr; gap:24px}
      .signup-header h1{font-size:2.2rem}
      .plan{padding:24px}
      .signup-form{padding:24px; margin:24px 16px}
    }
  </style>
</head>
<body>
  <header>
    <div class="container">
      <nav>
        <div class="logo">NXTRIX</div>
        <div>
          <a href="login.html" class="back-link" style="margin-right: 20px;">Login</a>
          <a href="index.html" class="back-link">‚Üê Back to Home</a>
        </div>
      </nav>
    </div>
  </header>

  <main>
    <div class="container">
      <div class="signup-header">
        <h1>Join NXTRIX CRM</h1>
        <p>Start your real estate investment journey with the perfect plan for your needs. All plans include a 7-day free trial.</p>
        
        <div class="toggle" style="display:flex; justify-content:center">
          <button id="monthlyToggle" class="active" onclick="setBilling('monthly')">Monthly</button>
          <button id="annualToggle" onclick="setBilling('annual')">Annual (Save up to 20%)</button>
        </div>
      </div>

      <div class="plans">
        <!-- Solo Plan -->
        <div class="plan">
          <h3>üöÄ Solo</h3>
          <div class="price">
            <span id="soloPrice" data-monthly="79" data-annual="65">$79</span>
            <span style="font-size:1rem; color:var(--muted)" id="soloBilling">/month</span>
          </div>
          <div class="price-note" id="soloNote">Monthly billing</div>
          <p class="description">Perfect for solo investors getting a taste of professional tools.</p>
          
          <ul class="features">
            <li>500 leads per month</li>
            <li>Basic deal analysis & ROI calculator</li>
            <li>Lead management & tracking</li>
            <li>Basic pipeline (5 stages)</li>
            <li>Basic email templates (10 templates)</li>
            <li>Property photo management</li>
            <li>Basic analytics dashboard</li>
            <li>Export to CSV</li>
            <li>Email support</li>
            <li>Basic API access (1,000 calls/month)</li>
            <li>1 user account</li>
            <li style="color: var(--warning);">LIMITED AI tools (10 analyses/month)</li>
            <li style="color: var(--warning);">LIMITED automation (1 workflow, 5 campaigns/month)</li>
            <li style="color: var(--warning);">LIMITED property data (25 lookups/month)</li>
            <li class="disabled">No team collaboration</li>
            <li class="disabled">No SMS messaging</li>
            <li class="disabled">No market insights & property history</li>
            <li class="disabled">No white-label features</li>
          </ul>
          
          <button class="btn secondary" onclick="selectPlan('solo', getCurrentPrice('solo'))">Start Solo Plan</button>
        </div>

        <!-- Team Plan -->
        <div class="plan featured">
          <h3>üíº Team</h3>
          <div class="price">
            <span id="teamPrice" data-monthly="119" data-annual="95">$119</span>
            <span style="font-size:1rem; color:var(--muted)" id="teamBilling">/month</span>
          </div>
          <div class="price-note" id="teamNote">Monthly billing</div>
          <p class="description">The sweet spot for growing teams. Maximum value for your investment.</p>
          
          <ul class="features">
            <li>Unlimited leads & prospects</li>
            <li>Full AI-powered deal analysis & scoring</li>
            <li>AI email template generation</li>
            <li>Email automation (100 campaigns/month)</li>
            <li>SMS messaging</li>
            <li>Advanced pipeline (10 custom stages)</li>
            <li>Team collaboration (5 users)</li>
            <li>Task assignment & tracking</li>
            <li>Advanced analytics & reports</li>
            <li>Property photo & document management</li>
            <li>Premium API access (15,000 calls/month)</li>
            <li>Email support</li>
            <li>Export to multiple formats</li>
            <li>Property data access (200 lookups/month)</li>
            <li>Market insights & property history</li>
            <li>Comparative market analysis</li>
            <li style="color: var(--warning);">Basic white-label options</li>
            <li class="disabled">No zoning & tax records</li>
            <li class="disabled">No unlimited property data</li>
          </ul>
          
          <button class="btn primary" onclick="selectPlan('team', getCurrentPrice('team'))">Start Team Plan</button>
        </div>

        <!-- Business Plan -->
        <div class="plan">
          <h3>üè¢ Business</h3>
          <div class="price">
            <span id="businessPrice" data-monthly="219" data-annual="175">$219</span>
            <span style="font-size:1rem; color:var(--muted)" id="businessBilling">/month</span>
          </div>
          <div class="price-note" id="businessNote">Monthly billing</div>
          <p class="description">Everything our software has to offer. Complete enterprise solution.</p>
          
          <ul class="features">
            <li>Everything in Team PLUS</li>
            <li>Unlimited everything (leads, users, automation)</li>
            <li>Advanced AI suite & recommendations</li>
            <li>Unlimited property data & lookups</li>
            <li>Complete market & demographic data</li>
            <li>Zoning, tax records & rental estimates</li>
            <li>AI investment scoring</li>
            <li>Advanced role permissions & security</li>
            <li>Custom analytics dashboards</li>
            <li>Full white-label customization</li>
            <li>Enterprise API access (35,000 calls/month)</li>
            <li>Premium support + dedicated success manager</li>
            <li>Custom feature development</li>
            <li>Custom training & onboarding</li>
            <li>Advanced security & compliance</li>
          </ul>
          
          <button class="btn secondary" onclick="selectPlan('business', getCurrentPrice('business'))">Start Business Plan</button>
        </div>
      </div>

      <!-- Signup Form -->
      <div class="signup-form" id="signupForm" style="display:none;">
        <h2>Create Your Account</h2>
        <p>Selected Plan: <span id="selectedPlan"></span> - $<span id="selectedPrice"></span>/month</p>
        
        <form id="registrationForm">
          <div class="form-group">
            <label for="email">Email Address</label>
            <input type="email" id="email" name="email" required placeholder="your@email.com">
          </div>
          
          <div class="form-group">
            <label for="password">Password</label>
            <input type="password" id="password" name="password" required placeholder="Choose a secure password" minlength="8">
          </div>
          
          <div class="form-group">
            <label for="fullName">Full Name</label>
            <input type="text" id="fullName" name="fullName" required placeholder="Your full name">
          </div>
          
          <div class="form-group">
            <label for="company">Company/Investment Business</label>
            <input type="text" id="company" name="company" placeholder="Optional - Your company name">
          </div>
          
          <div class="form-group">
            <label for="experience">Investment Experience</label>
            <select id="experience" name="experience" required>
              <option value="">Select your experience level</option>
              <option value="beginner">Beginner (0-1 years)</option>
              <option value="intermediate">Intermediate (2-5 years)</option>
              <option value="advanced">Advanced (5+ years)</option>
              <option value="expert">Expert (10+ years)</option>
            </select>
          </div>
          
          <button type="submit" class="btn primary">Start 7-Day Free Trial</button>
        </form>
        
        <p style="text-align:center; margin-top:20px; font-size:0.9rem; color:var(--muted);">
          By signing up, you agree to our <a href="privacy.html" style="color:var(--brand)">Privacy Policy</a> and <a href="terms.html" style="color:var(--brand)">Terms of Service</a>
        </p>
      </div>

      <!-- Trust Indicators -->
      <div class="trust">
        <h3>Trusted by Real Estate Investors</h3>
        <div class="trust-items">
          <div class="trust-item">SSL Encrypted</div>
          <div class="trust-item">GDPR Compliant</div>
          <div class="trust-item">Cancel Anytime</div>
          <div class="trust-item">7-Day Free Trial</div>
        </div>
      </div>
    </div>
  </main>

  <script>
    // Supabase client
    const sb = supabase.createClient(
      'https://ucrtaeoocwymzlykxgrf.supabase.co',
      'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InVjcnRhZW9vY3d5bXpseWt4Z3JmIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTQwNzM4MTIsImV4cCI6MjA2OTY0OTgxMn0.ZNjBkcR8vw00wmDcSYh-b1KdIel5233euuCToX-9-Lk'
    );

    // EmailJS initialization
    emailjs.init('cAvlcms2_FGEaSNQg');

    let selectedPlanData = {};
    let currentBilling = 'monthly';

    function setBilling(billing) {
      currentBilling = billing;
      
      // Update toggle buttons
      document.getElementById('monthlyToggle').classList.toggle('active', billing === 'monthly');
      document.getElementById('annualToggle').classList.toggle('active', billing === 'annual');
      
      // Update prices
      updatePricing();
    }

    function updatePricing() {
      const plans = ['solo', 'team', 'business'];
      
      plans.forEach(plan => {
        const priceElement = document.getElementById(`${plan}Price`);
        const noteElement = document.getElementById(`${plan}Note`);
        const billingElement = document.getElementById(`${plan}Billing`);
        
        if (currentBilling === 'annual') {
          const annualPrice = priceElement.getAttribute('data-annual');
          priceElement.textContent = `$${annualPrice}`;
          noteElement.textContent = 'Annual billing (save up to 20%)';
          billingElement.textContent = '/month';
        } else {
          const monthlyPrice = priceElement.getAttribute('data-monthly');
          priceElement.textContent = `$${monthlyPrice}`;
          noteElement.textContent = 'Monthly billing';
          billingElement.textContent = '/month';
        }
      });
    }

    function getCurrentPrice(plan) {
      const priceElement = document.getElementById(`${plan}Price`);
      if (currentBilling === 'annual') {
        return parseInt(priceElement.getAttribute('data-annual'));
      } else {
        return parseInt(priceElement.getAttribute('data-monthly'));
      }
    }

    // Check for URL parameters to pre-select plan
    const urlParams = new URLSearchParams(window.location.search);
    const preSelectedPlan = urlParams.get('plan');
    if (preSelectedPlan) {
      const planPrices = { 
        solo: { monthly: 79, annual: 65 }, 
        team: { monthly: 119, annual: 95 }, 
        business: { monthly: 219, annual: 175 } 
      };
      if (planPrices[preSelectedPlan]) {
        setTimeout(() => {
          const price = planPrices[preSelectedPlan][currentBilling];
          selectPlan(preSelectedPlan, price);
        }, 100);
      }
    }

    function selectPlan(planName, price) {
      selectedPlanData = { 
        plan: planName, 
        price: price,
        billing: currentBilling
      };
      document.getElementById('selectedPlan').textContent = planName.toUpperCase();
      document.getElementById('selectedPrice').textContent = price;
      document.getElementById('signupForm').style.display = 'block';
      document.getElementById('signupForm').scrollIntoView({ behavior: 'smooth' });
    }

    // Handle form submission
    document.getElementById('registrationForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      
      const formData = new FormData(e.target);
      const userData = {
        email: formData.get('email'),
        password: formData.get('password'),
        fullName: formData.get('fullName'),
        company: formData.get('company'),
        experience: formData.get('experience'),
        selectedPlan: selectedPlanData.plan,
        selectedPrice: selectedPlanData.price,
        billing: selectedPlanData.billing
      };

      try {
        // Show loading state
        const submitBtn = document.querySelector('button[type="submit"]');
        const originalText = submitBtn.textContent;
        submitBtn.textContent = 'Creating Account...';
        submitBtn.disabled = true;

        // Sign up with Supabase
        const { data, error } = await sb.auth.signUp({
          email: userData.email,
          password: userData.password,
          options: {
            data: {
              full_name: userData.fullName,
              company: userData.company,
              experience: userData.experience,
              selected_plan: userData.selectedPlan,
              selected_price: userData.selectedPrice,
              billing_cycle: userData.billing
            }
          }
        });

        if (error) throw error;

        // Send welcome email via EmailJS
        await emailjs.send('service_nxtrix', 'template_user', {
          to_email: userData.email,
          user_name: userData.fullName,
          selected_plan: userData.selectedPlan.toUpperCase(),
          selected_price: userData.selectedPrice,
          billing_cycle: userData.billing,
          company: userData.company || 'Not specified',
          experience: userData.experience
        });

        // Send admin notification
        await emailjs.send('service_nxtrix', 'template_admin', {
          user_email: userData.email,
          user_name: userData.fullName,
          selected_plan: userData.selectedPlan.toUpperCase(),
          selected_price: userData.selectedPrice,
          billing_cycle: userData.billing,
          company: userData.company || 'Not specified',
          experience: userData.experience
        });

        // Success - redirect to payment for checkout
        if (userData.selectedPlan && userData.selectedPlan !== 'free') {
          // Redirect to payment page with user data for immediate checkout
          const params = new URLSearchParams({
            plan: userData.selectedPlan,
            billing: userData.billing,
            email: userData.email,
            name: userData.fullName
          });
          window.location.href = `payment.html?${params.toString()}`;
        } else {
          // Free plan or no plan selected - go to CRM
          window.location.href = 'http://localhost:8501';
        }
        
      } catch (error) {
        console.error('Signup error:', error);
        alert('Error creating account: ' + error.message);
        
        // Reset button
        submitBtn.textContent = originalText;
        submitBtn.disabled = false;
      }
    });

    // Smooth scrolling for anchor links
    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
      anchor.addEventListener('click', function (e) {
        e.preventDefault();
        const target = document.querySelector(this.getAttribute('href'));
        if (target) {
          target.scrollIntoView({ behavior: 'smooth' });
        }
      });
    });
  </script>
</body>
</html>
